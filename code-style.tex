% ==============================
% Estilo para códigos fonte (code-style.tex)
% Correções incluídas:
% - define language=text (listings não tem por padrão)
% - define language=yaml (listings não tem por padrão)
% - define language=html (listings não tem por padrão)
% - melhora robustez do bash (derivado de sh, quando disponível)
% - mantém seu padrão UTF-8 via literate
% ==============================

\usepackage{listings}
\usepackage{xcolor}
\usepackage{upquote}

\lstset{
  inputencoding=utf8,
  extendedchars=true,
}

% ==============================
% Linguagem: Texto puro (logs, REPL, etc.)
% ==============================
\lstdefinelanguage{text}{
  basicstyle=\ttfamily\footnotesize,
  columns=fullflexible,
  keepspaces=true,
  showstringspaces=false,
  breaklines=true
}

% ==============================
% Linguagem: JavaScript
% ==============================
\lstdefinelanguage{JavaScript}{
  keywords={break, case, catch, continue, debugger, default, delete, do, else, finally, for, function, if, in, instanceof, new, return, switch, this, throw, try, typeof, var, void, while, with, let, const, await, async, yield},
  keywordstyle=\color{RoyalBlue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, from, as, interface, extends, public, private, protected, static, readonly, this, type},
  ndkeywordstyle=\color{BurntOrange}\bfseries,
  identifierstyle=\color{black},
  sensitive=true,
  comment=[l]//,
  morecomment=[s]{/*}{*/},
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{ForestGreen},
  morestring=[b]',
  morestring=[b]",
  morestring=[b]`
}

% ==============================
% Linguagem: TypeScript
% ==============================
\lstdefinelanguage{TypeScript}{
  keywords={break, case, catch, continue, debugger, default, delete, do, else, finally, for, function, if, in, instanceof, new, return, switch, this, throw, try, typeof, var, void, while, with, let, const, await, async, yield},
  keywordstyle=\color{RoyalBlue}\bfseries,
  ndkeywords={class, export, boolean, throw, implements, import, from, as, interface, extends, public, private, protected, static, readonly, namespace, type, enum, any, unknown, never, string, number, boolean, bigint, symbol, infer, keyof, typeof, this},
  ndkeywordstyle=\color{BurntOrange}\bfseries,
  identifierstyle=\color{black},
  sensitive=true,
  comment=[l]//,
  morecomment=[s]{/*}{*/},
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{ForestGreen},
  morestring=[b]',
  morestring=[b]",
  morestring=[b]`
}

% ==============================
% Linguagem: JSON
% ==============================
\lstdefinelanguage{json}{
  basicstyle=\ttfamily\footnotesize,
  showstringspaces=false,
  backgroundcolor=\color{gray!8},
  literate=
    *{0}{{{\color{blue}0}}}{1}
    {1}{{{\color{blue}1}}}{1}
    {2}{{{\color{blue}2}}}{1}
    {3}{{{\color{blue}3}}}{1}
    {4}{{{\color{blue}4}}}{1}
    {5}{{{\color{blue}5}}}{1}
    {6}{{{\color{blue}6}}}{1}
    {7}{{{\color{blue}7}}}{1}
    {8}{{{\color{blue}8}}}{1}
    {9}{{{\color{blue}9}}}{1}
    {:}{{{\color{black}:}}}{1}
    {,}{{{\color{black},}}}{1}
    {"}{{{\color{ForestGreen}"}}}{1},
}

% ==============================
% Linguagem: YAML
% ==============================
\lstdefinelanguage{yaml}{
basicstyle=\ttfamily\footnotesize,
sensitive=true,
morecomment=[l]{\#},
commentstyle=\color{gray}\itshape,
morestring=[b]",
morestring=[b]',
stringstyle=\color{ForestGreen},
columns=fullflexible,
keepspaces=true,
showstringspaces=false,
breaklines=true,
literate=
  {-}{{-}}1
{:}{{:}}1
}

% ==============================
% Linguagem: HTML
% ==============================
\lstdefinelanguage{html}{
  basicstyle=\ttfamily\footnotesize,
  sensitive=true,
  morecomment=[s]{<!--}{-->},
  commentstyle=\color{gray}\itshape,
  morestring=[b]",
  morestring=[b]',
  stringstyle=\color{ForestGreen},
  columns=fullflexible,
  keepspaces=true,
  showstringspaces=false,
  breaklines=true,
  morekeywords={
      html,head,meta,title,link,style,script,body,main,header,footer,section,article,nav,aside,
      div,span,p,a,img,ul,ol,li,table,thead,tbody,tr,th,td,
      form,input,button,label,select,option,textarea,
      h1,h2,h3,h4,h5,h6
    }
}

% ==============================
% Linguagem: Handlebars/Tempura (mínima)
% ==============================
\lstdefinelanguage{handlebars}{
  basicstyle=\ttfamily\footnotesize,
  sensitive=true,
  morecomment=[l]{{!}},        % {{! comment }}
  commentstyle=\color{gray}\itshape,
  morestring=[b]',             % ' strings
  morestring=[b]",             % " strings
  morestring=[b]`              % ` template strings
}

% ==============================
% Linguagem: SQL (Lucid ORM)
% ==============================
\lstdefinelanguage{SQL}{
  keywords={SELECT, INSERT, UPDATE, DELETE, FROM, WHERE, AND, OR, NOT, NULL, VALUES, INTO, CREATE, TABLE, PRIMARY, KEY, FOREIGN, REFERENCES, ON, JOIN, INNER, LEFT, RIGHT, FULL, OUTER, AS, ORDER, GROUP, BY, HAVING, LIMIT, OFFSET, DROP, ALTER, ADD, COLUMN, IF, EXISTS, DEFAULT, SERIAL},
  keywordstyle=\color{RoyalBlue}\bfseries,
  comment=[l]--,
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{ForestGreen},
  morestring=[b]',
  morestring=[b]",
  sensitive=false
}

% ==============================
% Linguagem: Shell (Adonis CLI)
% - Mantém nome "bash" (você já usa nos capítulos)
% - Usa base sh quando disponível (reduz chance de "Couldn't load requested language")
% ==============================
\lstdefinelanguage{bash}[]{sh}{
  basicstyle=\ttfamily\footnotesize,
  keywordstyle=\color{RoyalBlue}\bfseries,
  commentstyle=\color{gray}\itshape,
  stringstyle=\color{ForestGreen},
  morecomment=[l]{\#},
  morestring=[b]",
  morestring=[b]'
}

% ==============================
% Linguagem: ENV Files
% ==============================
\lstdefinelanguage{dotenv}{
  basicstyle=\ttfamily\footnotesize,
  sensitive=false,
  morecomment=[l]{\#},
  commentstyle=\color{gray}\itshape,
  morestring=[b]",
  stringstyle=\color{ForestGreen}
}

% ==============================
% Configuração Global
% ==============================
\lstset{
backgroundcolor=\color{gray!8},
basicstyle=\footnotesize\ttfamily,
keywordstyle=\color{RoyalBlue}\bfseries,
stringstyle=\color{ForestGreen},
commentstyle=\color{gray}\itshape,
numbers=left,
numberstyle=\tiny\color{gray},
stepnumber=1,
numbersep=8pt,
frame=single,
rulecolor=\color{gray!50},
tabsize=2,
breaklines=true,
captionpos=b,
showstringspaces=false,
inputencoding=utf8,
extendedchars=true,
columns=fullflexible,
keepspaces=true,
literate=
  {á}{{\'a}}1 {ã}{{\~a}}1 {â}{{\^a}}1 {à}{{\`a}}1
{é}{{\'e}}1 {ê}{{\^e}}1
{í}{{\'i}}1
{ó}{{\'o}}1 {õ}{{\~o}}1 {ô}{{\^o}}1
{ú}{{\'u}}1 {ü}{{\"u}}1
{ç}{{\c{c}}}1
{Á}{{\'A}}1 {Â}{{\^A}}1 {Ã}{{\~A}}1
{É}{{\'E}}1 {Ê}{{\^E}}1
{Í}{{\'I}}1
{Ó}{{\'O}}1 {Õ}{{\~O}}1 {Ô}{{\^O}}1
{Ú}{{\'U}}1
{Ç}{{\c{C}}}1
{`}{\textasciigrave}1
}
